r
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
tail(df_comb)
unique(df_comb$month)
tibble(df_comb)
tbl <- tibble(df_comb)
tail(tbl)
hist(tbl$month)
heaD(df_subset_ts)
head(df_subset_ts)
tail(df_subset_ts)
g
df_subsetHW
ggplot(df_subsetHW) + geom_raster(aes(x = x, y = y, fill = E))
head(df_subsetHW)
ggplot(df_subsetHW %>% filter(month == 9, year == 2018)) + geom_raster(aes(x = x, y = y, fill = obs))
ggplot(df_subsetHW %>% filter(month == 10, year == 2018)) + geom_raster(aes(x = x, y = y, fill = obs))
ggplot(df_subsetHW %>% filter(month == 12, year == 2018)) + geom_raster(aes(x = x, y = y, fill = obs))
ggplot(df_subsetHW %>% filter(month == 12, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
df_subset_ts
tail(df_subset_ts)
ggplot(df_subsetHW %>% filter(month == 12, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
df_subsetHW %>% filter(month == 12, year == 2018))%>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T))
df_subsetHW %>% filter(month == 12, year == 2018))
df_subsetHW %>% filter(month == 12, year == 2018)
df_subsetHW %>% filter(month == 12, year == 2018) %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T))
df_subsetHW %>% filter(year == 2018) %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T))
df_subsetHW %>% filter(year == 2018) %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T)) %>%
mutate(time = as.Date(paste(year, month, '15', sep = '-'), '%Y-%m-%d'),
hwname = hwname)
get_hw_spatial_average <- function(hwname, df_comb){
hw_bbox <- hw_polygons %>% filter(hwname == !!hwname) %>% st_bbox()
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
df_subset_ts <- df_subsetHW  %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T)) %>%
mutate(time = as.Date(paste(year, month, '15', sep = '-'), '%Y-%m-%d'),
hwname = hwname)
return(df_subset_ts)
}
df_subset_ts <- bind_rows(
get_hw_spatial_average(hwname = 'HW03', df_comb),
get_hw_spatial_average(hwname = 'HW10', df_comb),
get_hw_spatial_average(hwname = 'HW18a', df_comb),
get_hw_spatial_average(hwname = 'HW18b', df_comb)
)
start_year <- 2003; end_year <- 2018
hw_clim_ts <- df_subset_ts %>%
filter(year >= start_year & year <= end_year ) %>%
group_by(month, hwname) %>%
summarise(obs = mean(obs, na.rm = T),
sim = mean(sim, na.rm = T)) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname,'_clim'))
hw_clim_ts
tail(hw_clim_ts)
ts_all <- df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname, '_year')) %>%
left_join(hw_clim_ts, by = c('month', 'hwname', 'source')) %>%
# left_join(data.frame(year_of_hw = c(2003, 2010, 2018),
#                      month_of_hw = c(8, 7, 7)), by = "year_of_hw") %>%
pivot_longer(cols = c(paste0(varname,'_year'), paste0(varname,'_clim')),
names_to = 'type', values_to = varname)
tail(ts_al;)
tail(ts_all)
df_hw
df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname, '_year'))
df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname, '_year')) %>% tail()
df_hw
df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear'))
df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>% tail()
df_subset_ts %>%
tail()
hw_clim_ts
tail(df_subset_ts)
tail(hw_clim_ts)
hw_clim_ts <- df_subset_ts %>%
filter(year >= start_year & year <= end_year ) %>%
group_by(month, hwname) %>%
summarise(obs = mean(obs, na.rm = T),
sim = mean(sim, na.rm = T)) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname,'_clim'))
tail(hw_clim_ts)
df_subset_ts
df_subset_ts %>% filter(year == 2018, month == 12)
df_subset_ts %>% filter(year == 2018 & month == 12)
df_subset_ts %>% filter(year == 2018 & month == 12)
dum <- get_hw_spatial_average(hwname = 'HW18b', df_comb)
tail(dum)
hwname
hw_bbox <- hw_polygons %>% filter(hwname == !!hwname) %>% st_bbox()
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
tail(df_subsetHW)
tail(df_comb)
max(df_comb$month)
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
ggplot(df_subsetHW %>% filter(month == 12, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
varname
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
ggplot(df_subsetHW %>% filter(month == 12, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
ggplot(df_subsetHW %>% filter(month == 9, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
ggplot(df_subsetHW %>% filter(month == 9, year == 2018)) + geom_raster(aes(x = x, y = y, fill = obs))
ggplot(df_subsetHW %>% filter(month == 12, year == 2018)) + geom_raster(aes(x = x, y = y, fill = obs))
ts_all <- df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname, '_year')) %>%
left_join(hw_clim_ts, by = c('month', 'hwname', 'source')) %>%
# left_join(data.frame(year_of_hw = c(2003, 2010, 2018),
#                      month_of_hw = c(8, 7, 7)), by = "year_of_hw") %>%
pivot_longer(cols = c(paste0(varname,'_year'), paste0(varname,'_clim')),
names_to = 'type', values_to = varname)
g <- ggplot(ts_all, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = E, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('E_year'= 'cornflowerblue','E_clim'='grey20')) +
scale_y_continuous('E [mm]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
ggplot(df_comb %>% filter(month == 9, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
head(df_comb)
varname
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
ggplot(df_comb %>% filter(month == 9, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
ggplot(df_comb %>% filter(month == 12, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
g
hwname
hw_bbox <- hw_polygons %>% filter(hwname == !!hwname) %>% st_bbox()
hw_bbox
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
ggplot(df_comb %>% filter(month == 7, year == 2018)) + geom_raster(aes(x = x, y = y, fill = sim))
ggplot(df_comb %>% filter(month == 7, year == 2018)) + geom_raster(aes(x = x, y = y, fill = obs))
g
varname <- 'LAI'
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
get_hw_spatial_average <- function(hwname, df_comb){
hw_bbox <- hw_polygons %>% filter(hwname == !!hwname) %>% st_bbox()
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
df_subset_ts <- df_subsetHW  %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T)) %>%
mutate(time = as.Date(paste(year, month, '15', sep = '-'), '%Y-%m-%d'),
hwname = hwname)
return(df_subset_ts)
}
df_subset_ts <- bind_rows(
get_hw_spatial_average(hwname = 'HW03', df_comb),
get_hw_spatial_average(hwname = 'HW10', df_comb),
get_hw_spatial_average(hwname = 'HW18a', df_comb),
get_hw_spatial_average(hwname = 'HW18b', df_comb)
)
rm(df_comb)
start_year <- 2003; end_year <- 2018
ts_all <- df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname, '_year')) %>%
left_join(hw_clim_ts, by = c('month', 'hwname', 'source')) %>%
# left_join(data.frame(year_of_hw = c(2003, 2010, 2018),
#                      month_of_hw = c(8, 7, 7)), by = "year_of_hw") %>%
pivot_longer(cols = c(paste0(varname,'_year'), paste0(varname,'_clim')),
names_to = 'type', values_to = varname)
hw_labeller <- labeller(
hwname = c('HW03' = 'Aug. 2003', 'HW10' = 'Jul. 2010', 'HW18a' = 'Jul. 2018', 'HW18b' = 'Jul. 2018'))
hw_clim_ts <- df_subset_ts %>%
filter(year >= start_year & year <= end_year ) %>%
group_by(month, hwname) %>%
summarise(obs = mean(obs, na.rm = T),
sim = mean(sim, na.rm = T)) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname,'_clim'))
lgd <- theme(legend.position = 'bottom',
#legend.key.width = unit(1.2, units = 'cm'),
#panel.grid = element_blank(),
strip.text = element_text(size = 12))
g <- ggplot(ts_all, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = E, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('LAI_year'= 'cornflowerblue','LAI_clim'='grey20')) +
scale_y_continuous('LAI [m2/m2]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
g
ts_all
varname
varname <- 'LAI'
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
get_hw_spatial_average <- function(hwname, df_comb){
hw_bbox <- hw_polygons %>% filter(hwname == !!hwname) %>% st_bbox()
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
df_subset_ts <- df_subsetHW  %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T)) %>%
mutate(time = as.Date(paste(year, month, '15', sep = '-'), '%Y-%m-%d'),
hwname = hwname)
return(df_subset_ts)
}
df_subset_ts <- bind_rows(
get_hw_spatial_average(hwname = 'HW03', df_comb),
get_hw_spatial_average(hwname = 'HW10', df_comb),
get_hw_spatial_average(hwname = 'HW18a', df_comb),
get_hw_spatial_average(hwname = 'HW18b', df_comb)
)
rm(df_comb)
start_year <- 2003; end_year <- 2018
ts_all <- df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname, '_year')) %>%
left_join(hw_clim_ts, by = c('month', 'hwname', 'source')) %>%
# left_join(data.frame(year_of_hw = c(2003, 2010, 2018),
#                      month_of_hw = c(8, 7, 7)), by = "year_of_hw") %>%
pivot_longer(cols = c(paste0(varname,'_year'), paste0(varname,'_clim')),
names_to = 'type', values_to = varname)
hw_clim_ts <- df_subset_ts %>%
filter(year >= start_year & year <= end_year ) %>%
group_by(month, hwname) %>%
summarise(obs = mean(obs, na.rm = T),
sim = mean(sim, na.rm = T)) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname,'_clim'))
lgd <- theme(legend.position = 'bottom',
#legend.key.width = unit(1.2, units = 'cm'),
#panel.grid = element_blank(),
strip.text = element_text(size = 12))
hw_labeller <- labeller(
hwname = c('HW03' = 'Aug. 2003', 'HW10' = 'Jul. 2010', 'HW18a' = 'Jul. 2018', 'HW18b' = 'Jul. 2018'))
g <- ggplot(ts_all, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = E, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('LAI_year'= 'cornflowerblue','LAI_clim'='grey20')) +
scale_y_continuous('LAI [m2/m2]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
g
g <- ggplot(ts_all, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = LAI, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('LAI_year'= 'cornflowerblue','LAI_clim'='grey20')) +
scale_y_continuous('LAI [m2/m2]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
g
head(df_subset_ts)
ts_all
varname <- 'LAI'
get_ts_4_hw <- function(varname){
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
get_hw_spatial_average <- function(hwname, df_comb){
hw_bbox <- hw_polygons %>% filter(hwname == !!hwname) %>% st_bbox()
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
df_subset_ts <- df_subsetHW  %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T)) %>%
mutate(time = as.Date(paste(year, month, '15', sep = '-'), '%Y-%m-%d'),
hwname = hwname)
return(df_subset_ts)
}
df_subset_ts <- bind_rows(
get_hw_spatial_average(hwname = 'HW03', df_comb),
get_hw_spatial_average(hwname = 'HW10', df_comb),
get_hw_spatial_average(hwname = 'HW18a', df_comb),
get_hw_spatial_average(hwname = 'HW18b', df_comb)
)
rm(df_comb)
start_year <- 2003; end_year <- 2018
hw_clim_ts <- df_subset_ts %>%
filter(year >= start_year & year <= end_year ) %>%
group_by(month, hwname) %>%
summarise(obs = mean(obs, na.rm = T),
sim = mean(sim, na.rm = T)) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname,'_clim'))
ts_all <- df_subset_ts %>%
inner_join(df_hw, by = c('hwname' = 'hwname', 'year' = 'hwyear')) %>%
pivot_longer(cols = c('obs', 'sim'),
names_to = 'source', values_to = paste0(varname, '_year')) %>%
left_join(hw_clim_ts, by = c('month', 'hwname', 'source')) %>%
pivot_longer(cols = c(paste0(varname,'_year'), paste0(varname,'_clim')),
names_to = 'type', values_to = varname)
return(ts_all)}
ts_LAI <- get_ts_4_hw(varname = 'LAI')
ts_LST <- get_ts_4_hw(varname = 'LST')
ts_Albedo <- get_ts_4_hw(varname = 'Albedo')
ts_E <- get_ts_4_hw(varname = 'E')
ts_E
#### Export the data ####
save('ts_LAI', 'ts_LST', 'ts_Albedo', 'ts_E',
file = 'data/final_data/figures_for_paper/hw_ts.RData')
load('data/final_data/figures_for_paper/hw_ts.RData')   # <---- ...
lgd <- theme(legend.position = 'bottom',
#legend.key.width = unit(1.2, units = 'cm'),
#panel.grid = element_blank(),
strip.text = element_text(size = 12))
hw_labeller <- labeller(
hwname = c('HW03' = 'Aug. 2003', 'HW10' = 'Jul. 2010', 'HW18a' = 'Jul. 2018', 'HW18b' = 'Jul. 2018'))
gEVA <- ggplot(ts_E, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = E, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('E_year'= 'cornflowerblue','E_clim'='grey20')) +
scale_y_continuous('E [mm]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
gLAI <- ggplot(ts_LAI, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = LAI, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('LAI_year'= 'cornflowerblue','LAI_clim'='grey20')) +
scale_y_continuous('LAI [m2/m2]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
# assemble the figure
g <- gLAI + gEVA
# plotting details, in case not inherited...
if(exists('fig.path') != T){ fig.path <- 'paper/figures/'}
if(exists('fig.fmt') != T){ fig.fmt <- 'png'}
dir.create(path = fig.path, recursive = T, showWarnings = F)
fig.name <- 'heatwave_timeseries'
ggsave(filename = paste0(fig.name, '.', fig.fmt), plot = g,
path = fig.path, width = 10, height = 8)
gALB <- ggplot(ts_ALB, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = LAI, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('Albedo_year'= 'cornflowerblue','Albedo_clim'='grey20')) +
scale_y_continuous('Albedo [.]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
gALB <- ggplot(ts_Albedo, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = LAI, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('Albedo_year'= 'cornflowerblue','Albedo_clim'='grey20')) +
scale_y_continuous('Albedo [.]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
gALB
gALB <- ggplot(ts_Albedo, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = Albedo, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('Albedo_year'= 'cornflowerblue','Albedo_clim'='grey20')) +
scale_y_continuous('Albedo [.]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
gALB
ts_Albedo
ggplot(ts_Albedo, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = Albedo, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('Albedo_year'= 'cornflowerblue','Albedo_clim'='grey20')) +
scale_y_continuous('Albedo [.]')
gALB <- ggplot(ts_Albedo, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = Albedo, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('Albedo_year'= 'cornflowerblue','Albedo_clim'='grey20')) +
scale_y_continuous('Albedo [.]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
gALB
ts_LST
gLST <- ggplot(ts_LST, aes(x = month)) +
geom_vline(aes(xintercept = hwmonth), size = 14, colour = 'grey80') +
geom_line(aes(y = LST, colour = type, linetype = source)) +
facet_grid(hwname~., labeller = hw_labeller) +
#scale_colour_manual(values = c('LAI_clim'='grey20','LAI_year'= 'cornflowerblue')) +
scale_colour_manual(values = c('LST_year'= 'cornflowerblue','LST_clim'='grey20')) +
scale_y_continuous('LST [K]') +
scale_x_continuous('', expand = c(0,0),
breaks = c(3,6,9,12),
labels = c('3'='Mar', '6'='Jun', '9'='Sep', '12'='Dec')) +
#theme_bw() +
lgd
gLST
#### Export the figure ####
# assemble the figure
g <- gLAI + gLST + gEVA + gALB
# plotting details, in case not inherited...
if(exists('fig.path') != T){ fig.path <- 'paper/figures/'}
if(exists('fig.fmt') != T){ fig.fmt <- 'png'}
dir.create(path = fig.path, recursive = T, showWarnings = F)
fig.name <- 'heatwave_timeseries'
ggsave(filename = paste0(fig.name, '.', fig.fmt), plot = g,
path = fig.path, width = 14, height = 8)
# assemble the figure
g <- gLAI + gLST + gEVA + gALB + plot_layout(ncol = 4)
# plotting details, in case not inherited...
if(exists('fig.path') != T){ fig.path <- 'paper/figures/'}
if(exists('fig.fmt') != T){ fig.fmt <- 'png'}
dir.create(path = fig.path, recursive = T, showWarnings = F)
fig.name <- 'heatwave_timeseries'
ggsave(filename = paste0(fig.name, '.', fig.fmt), plot = g,
path = fig.path, width = 14, height = 8)
ts_Albedo <- get_ts_4_hw(varname = 'Albedo')
ts_Albedo
varname <- Albedo
varname <- 'Albedo'
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
get_hw_spatial_average <- function(hwname, df_comb){
hw_bbox <- hw_polygons %>% filter(hwname == !!hwname) %>% st_bbox()
df_subsetHW <- df_comb %>%
filter(x >= hw_bbox$xmin & x <= hw_bbox$xmax) %>%
filter(y >= hw_bbox$ymin & y <= hw_bbox$ymax)
df_subset_ts <- df_subsetHW  %>%
group_by(year, month) %>%
summarise(obs = mean(obs, na.rm = T), sim = mean(sim, na.rm = T)) %>%
mutate(time = as.Date(paste(year, month, '15', sep = '-'), '%Y-%m-%d'),
hwname = hwname)
return(df_subset_ts)
}
df_subset_ts <- bind_rows(
get_hw_spatial_average(hwname = 'HW03', df_comb),
get_hw_spatial_average(hwname = 'HW10', df_comb),
get_hw_spatial_average(hwname = 'HW18a', df_comb),
get_hw_spatial_average(hwname = 'HW18b', df_comb)
)
df_subset_ts
head(df_comb)
df_comb$nib
hist(df_comb$month)
varname <- 'LAI'
load(paste0(input_dir, 'df_comb___', varname, '.RData'))  # <--- df_comb
hist(df_comb$month)
source('~/work/workspace/f4p-era5-analysis/code/making_figures_for_paper/plot_heatwave_timeseries.R')
source('~/work/workspace/f4p-era5-analysis/code/making_figures_for_paper/plot_heatwave_timeseries.R')
source('~/work/workspace/f4p-era5-analysis/code/making_figures_for_paper/plot_hyst_summary_map.R')
gAll
source('~/work/workspace/f4p-era5-analysis/code/making_figures_for_paper/plot_hyst_summary_map.R')

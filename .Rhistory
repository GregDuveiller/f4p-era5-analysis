scale_x_date('') +
coord_cartesian(expand = F) +
ggtitle(label = 'Bias in ET for selected climate zones',
subtitle = '[ET_reanalysis (ERA5) - ET_observations (Theia)]')
source('~/work/workspace/f4p-era5-analysis/code/mkplots___temporal-devs-LAI.r')
df_all_comb <- left_join(df_LAI_comb,  df_ET_comb,
by = c("year", "monthS", "cz_name", "time"))
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
sel_cz <- c('Cfc', 'BSh', 'Dfb', 'Af', 'ET')
sel_cz <- c('Aw', 'Cfa', 'Cwb', 'Dfb', 'Am', 'Cwc')
# general plot for all climate zones
ggplot(df_all_comb) + # %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = ET_dif_mu, fill = cz_name),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_wrap(~cz_name, nc = 4) +
scale_fill_manual(values = cz_cols, guide = 'none') +
scale_y_continuous('Bias is ET (ERA - obs)') +
scale_x_continuous('Bias is LAI (ERA - obs)')
ggplot(df_all_comb) + # %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = ET_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_wrap(~cz_name, nc = 4) +
scale_fill_gradientn('Season', colours = kovesi.cyclic_mygbm_30_95_c78(12)) +
scale_y_continuous('Bias is ET (ERA - obs)') +
scale_x_continuous('Bias is LAI (ERA - obs)')
require(pals)
ggplot(df_all_comb) + # %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = ET_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_wrap(~cz_name, nc = 4) +
scale_fill_gradientn('Season', colours = kovesi.cyclic_mygbm_30_95_c78(12)) +
scale_y_continuous('Bias is ET (ERA - obs)') +
scale_x_continuous('Bias is LAI (ERA - obs)')
# plot for single climate zone with seasonality
ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = ET_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_wrap(~cz_name, nc = 2) +
scale_fill_gradientn(colours = kovesi.cyclic_mygbm_30_95_c78(12)) +
scale_y_continuous('Bias is ET (ERA - obs)') +
scale_x_continuous('Bias is LAI (ERA - obs)')
# vctr data
data_path <- '/Volumes/home/work/data/external_datasets/WorldVector/'
file.symlink(to = 'data/world_vectors', from = data_path)
# load vectors... (for coasts on figures)
wmap_df_land <- st_read('data/world_vectors/ne_50m_land.shp', quiet = T)
library(sf)
# load vectors... (for coasts on figures)
wmap_df_land <- st_read('data/world_vectors/ne_50m_land.shp', quiet = T)
wmap_df_ocean <- st_read('data/world_vectors/ne_50m_ocean.shp', quiet = T)
load('results/vardf4comparison/df_LAI_comb.RData', verbose = T)
load('results/vardf4comparison/df_LST_comb.RData', verbose = T)
load('results/vardf4comparison/df_ET_comb.RData', verbose = T)
load('results/vardf4comparison/df_SM_comb.RData', verbose = T)
by_vctr <- c("year", "monthS", "cz_name", "time")
df_all_comb <- bind_rows(
left_join(by = by_vctr,
x = df_LAI_comb,
y = df_LST_comb %>%
select(by_vctr, LST_dif_mu, LST_dif_sd) %>%
rename(y_mu = LST_dif_mu, y_sd = LST_dif_sd) %>%
mutate(y_mu_std = y_mu/sd(y_mu, na.rm = T),
y_sd_std = y_sd/sd(y_mu, na.rm = T),
y_var = 'LST')),
left_join(by = by_vctr,
x = df_LAI_comb,
y = df_ET_comb %>%
select(by_vctr, ET_dif_mu, ET_dif_sd) %>%
rename(y_mu = ET_dif_mu, y_sd = ET_dif_sd) %>%
mutate(y_mu_std = y_mu/sd(y_mu, na.rm = T),
y_sd_std = y_sd/sd(y_mu, na.rm = T),
y_var = 'ET')),
left_join(by = by_vctr,
x = df_LAI_comb,
y = df_SM_comb %>%
select(by_vctr, SM_dif_mu, SM_dif_sd) %>%
rename(y_mu = SM_dif_mu, y_sd = SM_dif_sd) %>%
mutate(y_mu_std = y_mu/sd(y_mu, na.rm = T),
y_sd_std = y_sd/sd(y_mu, na.rm = T),
y_var = 'SM'))) %>%
select(-LAI_obs_mu, -LAI_obs_sd, -LAI_rea_mu, -LAI_rea_sd) %>%
filter(!is.na(y_var))
library(here)
library(dplyr)
library(tidyr)
library(ggplot2)
library(pals)
library(patchwork)
df_all_comb <- bind_rows(
left_join(by = by_vctr,
x = df_LAI_comb,
y = df_LST_comb %>%
select(by_vctr, LST_dif_mu, LST_dif_sd) %>%
rename(y_mu = LST_dif_mu, y_sd = LST_dif_sd) %>%
mutate(y_mu_std = y_mu/sd(y_mu, na.rm = T),
y_sd_std = y_sd/sd(y_mu, na.rm = T),
y_var = 'LST')),
left_join(by = by_vctr,
x = df_LAI_comb,
y = df_ET_comb %>%
select(by_vctr, ET_dif_mu, ET_dif_sd) %>%
rename(y_mu = ET_dif_mu, y_sd = ET_dif_sd) %>%
mutate(y_mu_std = y_mu/sd(y_mu, na.rm = T),
y_sd_std = y_sd/sd(y_mu, na.rm = T),
y_var = 'ET')),
left_join(by = by_vctr,
x = df_LAI_comb,
y = df_SM_comb %>%
select(by_vctr, SM_dif_mu, SM_dif_sd) %>%
rename(y_mu = SM_dif_mu, y_sd = SM_dif_sd) %>%
mutate(y_mu_std = y_mu/sd(y_mu, na.rm = T),
y_sd_std = y_sd/sd(y_mu, na.rm = T),
y_var = 'SM'))) %>%
select(-LAI_obs_mu, -LAI_obs_sd, -LAI_rea_mu, -LAI_rea_sd) %>%
filter(!is.na(y_var))
cols7 <- viridis(n = 7)
cols <- c(cols7, cols7[6:2])
sel_cz <- c('Cfc', 'BSh', 'Dfb', 'Af', 'ET')
sel_cz <- c('Aw', 'Cfa', 'Cwb', 'Dfb', 'Am', 'Cwc')
sel_cz <- c('Aw', 'Cfa',  'Dfb')
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_plots
load('results/ancillary_info/df_KG_climatezones.RData', verbose = T)
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz),
aes(x = x, y = y)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0)+
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0)+
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
df_cz
head(df_cz)
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
?patchwork
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
ggsave(filename = 'test_cz_delta-delta-plot.png',
path = out.path, plot = g,width = 12, height = 7)
out.path <- 'results/plots4comparison/'
ggsave(filename = 'test_cz_delta-delta-plot.png',
path = out.path, plot = g,width = 12, height = 7)
ggsave(filename = 'test_cz_delta-delta-plot.png',
path = out.path, plot = g_combo, width = 12, height = 7)
cz_grp <- 'A'
cz_lbl <- 'tropical climates'
sel_cz <- c('Af', 'Am', 'As', 'Aw')
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for', cz_lbl)) +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
cz_grp <- 'A'
cz_lbl <- 'tropical climates'
sel_cz <- c('Af', 'Am', 'As', 'Aw')
fmt = 'png'
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for', cz_lbl)) +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
ggsave(filename = paste0('czd2plot__', cz_grp, '.', fmt),
path = out.path, plot = g_combo, width = 12, height = 7)
ggsave(filename = paste0('czd2plot__', cz_grp, '.', fmt),
path = out.path, plot = g_combo, width = 12, height = 8)
length(sel_cz)
length(sel_cz) * 2
length(sel_cz) * 2 + 1
length(sel_cz)-1 * 2 + 1
(length(sel_cz)-1) * 2 + 1
plot_per_clim <- function(cz_grp, cz_lbl, sel_cz, fmt = 'png'){
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', cz_lbl)) +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
ggsave(filename = paste0('czd2plot__', cz_grp, '.', fmt),
path = out.path, plot = g_combo, width = 12,
height = length(sel_cz) * 2 + 1)
}
cz_grp <- 'A'
cz_lbl <- 'tropical climates'
sel_cz <- c('Af', 'Am', 'As', 'Aw')
plot_per_clim(cz_grp, cz_lbl, sel_cz)
cz_name
df_lgd$cz_name
grep(pattern = 'A', x = df_lgd$cz_name)
grep(pattern = 'B', x = df_lgd$cz_name)
grep(pattern = 'Cf', x = df_lgd$cz_name)
cz_lbl
grep(pattern = 'Cf', x = df_lgd$cz_name)df_lgd
df_lgd
# load clim zone locations...
load('results/ancillary_info/df_KG_climatezones.RData', verbose = T)
# load clim zone locations...
load('results/ancillary_info/df_KG_climatezones.RData', verbose = T) # df_lgd
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = df_lgd$cz_colours) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
df_lgd$cz_colours
plot_per_clim <- function(cz_grp, cz_lbl, df_lgd, fmt = 'png'){
sel_cz <- grep(pattern = cz_grp, x = df_lgd$cz_name)
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', cz_lbl)) +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
ggsave(filename = paste0('czd2plot__', cz_grp, '.', fmt),
path = out.path, plot = g_combo, width = 12,
height = length(sel_cz) * 2 + 1)
}
plot_per_clim <- function(cz_grp, cz_lbl, df_lgd, fmt = 'png'){
sel_cz <- grep(pattern = cz_grp, x = df_lgd$cz_name)
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', cz_lbl)) +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
ggsave(filename = paste0('czd2plot__', cz_grp, '.', fmt),
path = out.path, plot = g_combo, width = 12,
height = length(sel_cz) * 2 + 1)
}
plot_per_clim('A', 'tropical climates', df_lgd, 'png')
sel_cz <- grep(pattern = cz_grp, x = df_lgd$cz_name)
cz_grp
cz_lbl
df_lgd
sel_cz <- grep(pattern = cz_grp, x = df_lgd$cz_name)
sel_cz
df_lgd
sel_cz <- df_lgd$cz_name[grep(pattern = cz_grp, x = df_lgd$cz_name)]
sel_cz
plot_per_clim <- function(cz_grp, cz_lbl, df_lgd, fmt = 'png'){
sel_cz <- df_lgd$cz_name[grep(pattern = cz_grp, x = df_lgd$cz_name)]
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', cz_lbl)) +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_wrap(~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
ggsave(filename = paste0('czd2plot__', cz_grp, '.', fmt),
path = out.path, plot = g_combo, width = 12,
height = length(sel_cz) * 2 + 1)
}
plot_per_clim('A', 'tropical climates', df_lgd, 'png')
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_grid(.~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
sel_cz
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_grid(.~cz_name, nr = length(sel_cz)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_grid(.~cz_name) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_grid(cz_name~.) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
cz_lbl
g_maps <- ggplot(df_cz %>% filter(cz_name %in% sel_cz) %>% mutate(cz_grp = cz_lbl)) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_grid(cz_name~cz_grp) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', cz_lbl))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_grid(cz_name~cz_grp) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
plot_per_clim <- function(cz_grp, cz_lbl, df_lgd, fmt = 'png'){
sel_cz <- df_lgd$cz_name[grep(pattern = cz_grp, x = df_lgd$cz_name)]
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
g_plots <- ggplot(df_all_comb %>% filter(cz_name %in% sel_cz)) +
geom_point(aes(x = LAI_dif_mu, y = y_mu_std, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
facet_grid(cz_name~y_var) +
scale_fill_gradientn('Month', colours = cols) +
scale_y_continuous('Standardized bias in Y_var (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', cz_lbl)) +
theme(legend.position = 'left',
legend.key.height = unit(3, units = 'cm'))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', cz_lbl))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
facet_grid(cz_name~cz_grp) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_plots + g_maps + plot_layout(ncol = 2, widths = c(3, 2))
ggsave(filename = paste0('czd2plot__', cz_grp, '.', fmt),
path = out.path, plot = g_combo, width = 12,
height = length(sel_cz) * 2 + 1)
}
plot_per_clim('A', 'tropical climates', df_lgd, 'png')
plot_per_clim('B', 'dry climates', df_lgd, 'png')
plot_per_clim('Cs', 'temperature mediterranean climates', df_lgd, 'png')
plot_per_clim('A', 'tropical climates', df_lgd, 'png')
plot_per_clim('B', 'dry climates', df_lgd, 'png')
plot_per_clim('Cs', 'temperate mediterranean climates', df_lgd, 'png')
plot_per_clim('Cw', 'dry-winter temperate climates', df_lgd, 'png')
plot_per_clim('Cf', 'no-dry-season temperate climates', df_lgd, 'png')
plot_per_clim('Ds', 'dry-summer continental climates', df_lgd, 'png')
plot_per_clim('Dw', 'dry-winter continental climates', df_lgd, 'png')
plot_per_clim('Df', 'no-dry-season continental climates', df_lgd, 'png')

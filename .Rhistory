legend.key.height = unit(1.5, units = 'cm'))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) # + plot_layout(ncol = 2, widths = c(3, 8))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 10,
height = 8)
plot_per_clim_single('Cfa', df_lgd, 'png')
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', sel_cz)) +
theme(legend.position = 'left',
legend.key.height = unit(1.5, units = 'cm'))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('LST_dif_mu', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', sel_cz)) +
theme(legend.position = 'right',
legend.key.height = unit(1.5, units = 'cm'))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) # + plot_layout(ncol = 2, widths = c(3, 8))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 10,
height = 8)
}
plot_per_clim_single('Cfa', df_lgd, 'png')
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', sel_cz)) +
theme(legend.position = 'left',
legend.key.height = unit(1.5, units = 'cm'))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('LST_dif_mu', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
ggtitle(label = paste0('Patterns for selected variables in ', sel_cz)) +
theme(legend.position = 'right',
legend.key.height = unit(1.5, units = 'cm'))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) # + plot_layout(ncol = 2, widths = c(3, 8))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 10,
height = 8)
}
plot_per_clim('Aw',  df_lgd, 'png')
ggtitle(label = paste0('Patterns for selected variables in ', sel_cz)) +
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'left',
legend.key.height = unit(1.5, units = 'cm'))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('LST_dif_mu', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'right',
legend.key.height = unit(1.5, units = 'cm'))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) # + plot_layout(ncol = 2, widths = c(3, 8))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 8,
height = 8)
}
plot_per_clim('Aw',  df_lgd, 'png')
plot_per_clim('Cfa', df_lgd, 'png')
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'right',
legend.key.height = unit(1.5, units = 'cm'))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('LST_dif_mu', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'left',
legend.key.height = unit(1.5, units = 'cm'))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) + plot_layout(nrow = 2, heights = c(2,1 ))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 8,
height = 8)
}
plot_per_clim('Aw',  df_lgd, 'png')
plot_per_clim('Cfa', df_lgd, 'png')
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.height = unit(1.5, units = 'cm'))+
guides(fill = guide_colourbar(title.position = 'top'))
g_plot1
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm'))+
guides(fill = guide_colourbar(title.position = 'top'))
g_plot1
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm'))+
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_plot1
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('LST_dif_mu', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.height = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) + plot_layout(nrow = 2, heights = c(3/5, 2/5 ))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 8,
height = 8)
}
plot_per_clim('Aw',  df_lgd, 'png')
plot_per_clim('Cfa', df_lgd, 'png')
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('LST_dif_mu', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) + plot_layout(nrow = 2, heights = c(3/5, 2/5 ))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 8,
height = 8)
}
plot_per_clim('Aw',  df_lgd, 'png')
plot_per_clim('Cfa', df_lgd, 'png')
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('LST_dif_mu', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) + plot_layout(nrow = 2, heights = c(3/5, 2/5 ))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 8,
height = 8)
}
plot_per_clim('Aw',  df_lgd, 'png')
plot_per_clim('Csa', df_lgd, 'png')
plot_per_clim('Cwa', df_lgd, 'png')
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Bias in LST (ERA - obs)', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'bottom',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) + plot_layout(nrow = 2, heights = c(2/5, 3/5 ))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 8,
height = 8)
}
plot_per_clim('Aw',  df_lgd, 'png')
plot_per_clim('Cfa', df_lgd, 'png')
plot_per_clim('Csa', df_lgd, 'png')
plot_per_clim('Cwa', df_lgd, 'png')
plot_per_clim('Af',  df_lgd, 'png')
plot_per_clim('Cfb', df_lgd, 'png')
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none',title = element_text(hjust = 0.5)) +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none',title = element_text(vjust = 0.5)) +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_maps
plot_per_clim <- function(sel_cz,  df_lgd, fmt = 'png'){
cz_cols <- df_lgd$cz_colours
names(cz_cols) <- df_lgd$cz_name
data <- df_all_comb %>% filter(cz_name %in% sel_cz)
g_plot1 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_dif_mu, fill = monthS),
colour = 'grey35', shape = 21) +
geom_hline(yintercept = 0, colour = 'grey20') +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Month', colours = cols_mon) +
scale_y_continuous('Bias in LST (ERA - obs)') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'top',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_plot2 <- ggplot(data) +
geom_point(aes(x = LAI_dif_mu, y = LST_obs_mu - 273.15, fill = LST_dif_mu),
colour = 'grey35', shape = 21) +
geom_vline(xintercept = 0, colour = 'grey20') +
scale_fill_gradientn('Bias in LST (ERA - obs)', colours = cols_lst,
limits = c(-1,1) * max(abs(range(data$LST_dif_mu, na.rm = T)))) +
scale_y_continuous('Mean LST (obs) [K]') +
scale_x_continuous('Bias in LAI (ERA - obs)') +
theme(legend.position = 'top',
legend.key.width = unit(1.5, units = 'cm')) +
guides(fill = guide_colourbar(title.position = 'top', title.hjust = 0.5))
g_maps <- ggplot(df_cz %>%
filter(cz_name %in% sel_cz) %>%
mutate(cz_grp = paste('Distribution of', sel_cz))) +
geom_sf(data = wmap_df_land, fill='Grey50',colour='Grey50',size=0) +
geom_sf(data = wmap_df_ocean, fill='Grey20',colour='Grey20',size=0) +
geom_tile(aes(x = x, y = y, fill = cz_name)) +
scale_fill_manual('Koppen-Geiger climate zones', values = cz_cols) +
scale_y_continuous('Latitude', expand = c(0, 0)) +
scale_x_continuous('Longitude', expand = c(0, 0)) +
ggtitle(label = paste0('Heat bias due to LAI bias over climate ', sel_cz)) +
theme(legend.position = 'none') +
guides(fill = guide_legend(title.position = 'top', nrow = 4))
g_combo <- g_maps / (g_plot1 + g_plot2) + plot_layout(nrow = 2, heights = c(2/5, 3/5 ))
ggsave(filename = paste0('LAIbias_perCZ_', sel_cz, '.', fmt),
path = out.path, plot = g_combo, width = 8,
height = 8)
}
plot_per_clim('Af',  df_lgd, 'png')
plot_per_clim('Aw',  df_lgd, 'png')
plot_per_clim('Cfa', df_lgd, 'png')
plot_per_clim('Cfb', df_lgd, 'png')
plot_per_clim('Csa', df_lgd, 'png')
plot_per_clim('Cwa', df_lgd, 'png')
library(ggplot2)
library(dplyr)
library(tidyr)
# set output path
out.path <- 'results/vardf4comparison'
# get some general ancillary info
load('results/ancillary_info/df_KG_climatezones.RData') #  'df_cz' and 'df_lgd'
LAI_files <- list.files(path = 'data/r_data_frames',
pattern = 'theia_025', full.names = T)
(load('../../jeodpp/eos_user_home/F4P/df_albedo_ERA5l_025_2015.RData'))
head(df)
df_ERA <- df
(load('../../jeodpp/eos_user_home/F4P/df_albedo_NASA_025_wsa_nir_2015.RData'))
head(df)
ggplot(df) + geom_raster(aes(x = x, y = y, fill = wsa_nir_QAok)) + scale_fill_viridis_c()
ggplot(df %>% month == 5) + geom_raster(aes(x = x, y = y, fill = wsa_nir_QAok)) + scale_fill_viridis_c()
ggplot(df %>% filter(month == 5)) + geom_raster(aes(x = x, y = y, fill = wsa_nir_QAok)) + scale_fill_viridis_c()
ggplot(df_ERA %>% filter(month == 5)) + geom_raster(aes(x = x, y = y, fill = alnid)) + scale_fill_viridis_c()
df_comb <- left_join(df, df_ERA, by = c('x', 'y', 'year', 'month'))
head(df_comb)
ggplot(df_comb %>% filter(month == 5)) + geom_raster(aes(x = x, y = y, fill = wsa_nir_QAok-alnid)) + scale_fill_gradientn(colours = brewer.rdbu(9), limits = c(-0.05, 0.05))
load('results/vardf4comparison/df_LST_comb.RData', verbose = T)
head(df_LST_comb)
